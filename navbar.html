<nav>
  <div class="nav-left">
    <a href="index.html" class="home-link" aria-label="Home Control Dashboards">
      <img class="nav-icon" src="https://img.icons8.com/?size=100&id=9zcV0gKAozhn&format=png&color=FFFFFF" alt="home icon">
      Home
    </a>
  </div>

  <div class="nav-center" role="navigation" aria-label="Navegação principal">
    <div class="container-aicon">
      <a href="quintoandar.html">
        <img class="nav-icon-quinto" src="https://lh3.googleusercontent.com/d/1FTVmJwXDds1WnukeDH4vaShIvwYLrMK8=w1920-h1080" alt="">
        Quinto Andar
      </a>
    </div>

    <div class="container-aicon">
      <a class="a-no-gap" href="boticario.html">
        <img class="nav-icon" src="https://lh3.googleusercontent.com/d/12TydZaPgmAYn3Pm3HwWGeAOBb90n72Cf=w1920-h1080" alt="">
        Boticário
      </a>
    </div>

    <div class="container-aicon">
      <a href="santander.html" >
        <img class="nav-icon-santander" src="https://lh3.googleusercontent.com/d/1tiJu4td3SfifkJKq7Xj_7-ZaqHImQ8dt=w1920-h1080" alt="">
        Santander
      </a>
    </div>
    
    <div class="container-aicon">
      <a href="zurich.html" >
        <img class="nav-icon-zurich" src="https://lh3.googleusercontent.com/d/1neeXZv0wZ-CmIqIdsxa37xQjxh7I3PMT=w1920-h1080" alt="">
        Zurich
      </a>
    </div>

    <div class="container-aicon">
      <a class="a-no-gap" href="copaenergia.html">
        <img class="nav-icon" src="https://lh3.googleusercontent.com/d/1VFkH8VqAO4l1jzZQe9v3wLDXXAppRZUG=w1920-h1080" alt="">
        Copa Energia
      </a>
    </div>

  </div>

  <div class="nav-left">
    <a href="domo.html" class="home-link" aria-label="Home Control Dashboards">
      <img class="nav-icon" src="https://img.icons8.com/?size=100&id=78770&format=png&color=FFFFFF" alt="home icon">
      DOMO
    </a>
  </div>
</nav>

<script>
(function () {
  const MAX_TRIES = 12;
  const TRY_INTERVAL_MS = 100;

  function normalizeUrl(u) {
    try {
      return u.replace(/#.*$/, '').replace(/\/$/, '');
    } catch (e) { return u; }
  }

  function init() {
    const links = document.querySelectorAll('nav a[href$=".html"], nav a[href="index.html"]');

    if (!links || links.length === 0) {
      console.warn('[NAVBAR] Nenhum link .html encontrado — aguardando elemento.');
      return false;
    }

    const current = normalizeUrl(window.location.pathname.split('/').pop() || 'index.html');

    links.forEach(link => {
      // Remove handler anterior
      link.removeEventListener('click', link.__nav_handler__);

      // Cria novo handler
      const handler = handleClickWrapper.bind(link);
      link.__nav_handler__ = handler;
      link.addEventListener('click', handler);

      // ➤ Destacar página atual
      const linkTarget = normalizeUrl(link.getAttribute('href') || "");

      if (linkTarget === current) {
        link.style.color = 'var(--highlight)';
        link.style.textShadow = '0 4px 18px rgba(0,0,0,0.45)';
      }
    });

    console.info('[NAVBAR] Inicializado com sucesso.');
    return true;
  }

  function tryNavigateTop(url) {
    try {
      window.top.location.href = url;
      return true;
    } catch (err) {
      return false;
    }
  }

  function tryOpenTop(url) {
    try {
      const win = window.open(url, '_top');
      return !!win;
    } catch (err) {
      return false;
    }
  }

  function tryLocalAssign(url) {
    try {
      window.location.href = url;
      return true;
    } catch (err) {
      return false;
    }
  }

  function handleClickWrapper(e) {
    e.preventDefault();

    try {
      const targetUrl = this.getAttribute('href');
      if (!targetUrl) return;

      const normTarget = normalizeUrl(targetUrl);
      const current = normalizeUrl(window.location.pathname.split('/').pop() || "");

      if (normTarget === current) {
        console.debug('[NAVBAR] já estamos nesta página:', normTarget);
        return;
      }

      document.body.classList.add('page-exit');

      setTimeout(() => {
        if (tryNavigateTop(targetUrl)) return;
        if (tryOpenTop(targetUrl)) return;
        if (tryLocalAssign(targetUrl)) return;

        alert('Não foi possível navegar automaticamente. Acesse:\n' + targetUrl);
      }, 300);

    } catch (err) {
      console.error('[NAVBAR] erro inesperado:', err);
      try {
        window.location.href = this.getAttribute('href');
      } catch (e) { }
    }
  }

  function readyAndInit() {
    let tries = 0;
    function attempt() {
      tries++;
      const ok = init();
      if (!ok && tries < MAX_TRIES) {
        setTimeout(attempt, TRY_INTERVAL_MS);
      } else if (!ok) {
        console.error('[NAVBAR] falhou após várias tentativas');
      }
    }

    if (document.readyState === "complete" || document.readyState === "interactive") {
      attempt();
    } else {
      document.addEventListener("DOMContentLoaded", attempt, { once: true });
    }
  }

  readyAndInit();
})();
</script>
